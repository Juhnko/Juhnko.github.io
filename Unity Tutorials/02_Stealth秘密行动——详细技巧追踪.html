
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='02_Socket与WebSocket的区别与联系？.html'>02_Socket与WebSocket的区别与联系？</a>, Previous: <a href='03_PhotonServer（光子服务器）简单了解及部署.html'>03_PhotonServer（光子服务器）简单了解及部署</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>02_Stealth秘密行动——详细技巧追踪</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><h1 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 28px; color: rgb(79, 79, 79); line-height: 36px; word-wrap: break-word;">Unity 2-7 Stealth秘密行动</h1><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Abstract; &nbsp;向量运算；Animation动画；Navigation寻路系统；Mecanim动画系统</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t1" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t1" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务1&amp;2&amp;3：游戏介绍&nbsp;&amp;&amp;&nbsp;创建工程和游戏场景介绍 &amp;&amp;&nbsp;创建游戏环境</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">逃生游戏，过关条件为拿到钥匙并从电梯处逃脱<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">被敌人/&nbsp;摄像头/&nbsp;触碰红外线 --&nbsp;触发警报<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">红外线可以手动断电</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/B0F8A19F1695C2E66CE74EA9F1258FC1.png" alt="" width="850" height="709" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><img src="resources/BC8649EA696BEB7FA73C4AB6C868FC2F.png" alt="" width="777" height="673" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">右上图场景是美工创建好的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Import package-&gt;Custom package: StealthAssets.unitypackage</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">资源介绍：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Animation, Audio, Fonts, Gizmos, Materials, Models, Shaders, Textures</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Animation中的.fdx文件是从3d软件中导出的动画模型<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">humanoid动画可以应用在任意人形模型上</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/B7B8E068AA963DEC816E2BDAABC00846.png" alt="" width="421" height="483" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Audio：声音文件<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Fonts：字体<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Gizmos：waypoint的图标，用于敌人寻路的AI，用图标表示路径<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Materials：材质<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Models：模型（环境模型、物品模型等）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　里面有一个文件夹Collision Meshes，存放collision的mesh，用于碰撞检测<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　比如prop_cctvCam_collision:&nbsp;一个椎体，用来检测player是否进入了摄像头视野<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Shaders：更好的效果<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Textures：模型的贴图</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建游戏环境：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　1. 新建文件夹Scenes，保存场景Stealth<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　2.&nbsp;创建空物体env，用于存放有关环境的物体<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　3. 将Models-&gt;env_stealth_static拖入场景(env下)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Reset Transform<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　4.&nbsp;给env_stealth_static添加碰撞器<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　添加Mesh Collider<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在Mesh属性中指定简化的Models-&gt;Collision Meshes:&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　env_stealth_collision-&gt;env_stealth_collision_001<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在scene模式下，可以看到的绿色网格就是刚才的collision</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建battleBus：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　发现中间一块有一个突起的mesh&nbsp;collider，而没有物体存在<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　由于在env_stealth_static中没有放入位于地图中间的小车</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/4A616F48C6EE34EA861C8B52C65B06B0.png" alt="" width="1176" height="525" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">因此手动添加prop_battleBus到地图内 (作为env子物体)，并旋转到车头朝向杂物，位置与Mesh Collider重合即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/FA381B36FEC8833E730DF93B2C0734AF.png" alt="" width="1029" height="356" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t2" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t2" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务4：添加环境灯光</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给环境添加环境灯光：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在最外层创建空物体light (位置归零)，用于存放所有灯光<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在light中创建Directional Light，颜色为暗一点的灰色，Intensity调小(0.1)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Main Camera背景颜色调为黑色，Clear Flags调为Solid&nbsp;color</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给房间添加灯光：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在light中创建Point Light，颜色为暗橘黄色，<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　一个房间添加一个，在四周的墙上或过于阴暗的地方放置若干</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/84CFE064C88CAF3FC0163BCEF71B260E.png" alt="" width="628" height="747" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t3" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t3" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务5&amp;6：添加警报灯 &amp;&amp;&nbsp;添加警报声</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">实现<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">警报灯</span>：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">添加Directional Light: AlarmLight，红色，触发警报的时候Intensity在0.1~0.5之间不断变化<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">在AlarmLight上添加脚本AlarmController.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">public bool isAlarmOn = false; // Flag<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private float lowest/highestIntensity = 0.1/ 0.5; //&nbsp;指定最高值最低值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private float targetIntensity; //&nbsp;当前需要往lowest还是highest靠近</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Awake()中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　targetIntensity = highestIntensity; //&nbsp;默认是从lowest变到highest的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　isAlarmOn = false; //&nbsp;确保刚开始警报未触发</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Update()中实现警报灯闪烁的效果：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(isAlarmOn) { //&nbsp;警报开启状态<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　light.intensity=Mathf.Lerp(ligh.intensity, targetIntensity, Time.deltaTime*speed);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">现在的警报实现了从lowestIntensity到highestIntensity的变亮过程<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　判断接近 (Lerp是一个无限趋近的过程) targetIntensity后，改变target的值</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　if(Mathf.Abs(light.intensity - targetIntansity) &lt; 0.05f) { //&nbsp;达到目标值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(targetIntensity == highestIntensity) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　targetIntensity = lowestIntensity;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　} else {&nbsp;同理; }</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当警报消除的时候，需要将Intensity设为0（直接设置会显得不自然，采用Lerp方法）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　light.intensity = Mathf</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">但是（个人认为）这么写需要一直执行intensity的赋值操作</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">为了让外界访问AlarmController.cs方便，采用单例模式<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　public static AlarmController _instance;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Awake()中：_instance = this;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在外界直接访问_instance即可</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 30px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">class</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> AlarmController : MonoBehaviour {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">static</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> AlarmController _instance;

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">bool</span> isAlarmOn = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Light alarmLight;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> lowestIntensity = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.1f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> highestIntensity = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.75f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> targetIntensity;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> currentIntensity;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> intensityChangeSpeed =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> 5f;

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Awake () {
        _instance </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">this</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        targetIntensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> highestIntensity;
        currentIntensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> lowestIntensity;
        isAlarmOn </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        alarmLight </span>= GetComponent&lt;Light&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">();
    }

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update() {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (isAlarmOn) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (Mathf.Abs(currentIntensity - targetIntensity) &lt; <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.05</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (targetIntensity.Equals(highestIntensity)) {
                    targetIntensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> lowestIntensity;
                } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
                    targetIntensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> highestIntensity;
                }
            }
            currentIntensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Mathf.Lerp(currentIntensity, targetIntensity, 
                Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> intensityChangeSpeed);
        } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 警报处于关闭状态</span>
            currentIntensity = Mathf.Lerp(currentIntensity, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, 
                Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> intensityChangeSpeed);
        }
        alarmLight.intensity </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> currentIntensity;
    } 
}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">实现<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">警报声</span>效果：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在env_stealth_static模型里会找到若干个喇叭: prop_magaphone<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">对这六个喇叭添加AudioSource组件，用于播放声音 alarm_triggered<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">取消勾选play&nbsp;on&nbsp;awake<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">将Min Distance设置大一点 (5)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">之后需要播放警报声时，需要找到这六个喇叭，因此把他们设置为tag=Siren</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t4" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t4" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务7：游戏控制器GameController --&nbsp;控制整个游戏的运行</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">游戏控制器：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　灯光、声音、警报主角位置（比如主角位置暴露了，需要记录看到主角的最新位置，让机<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　器人朝着最新位置移动）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体GameController，添加GameController.cs脚本</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">需要控制警报灯：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　public bool isAlarmOn = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Update()中将isAlarmOn传递给任务6中的单例模式AlarmController<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　//&nbsp;因为要随时控制isAlarmOn的值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　AlarmController._instance.isAlarmOn = this.isAlarmOn;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">需要控制警报声：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 得到六个警报喇叭<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　private GameObject[] sirens = GameObject.FindGameObjectsWithTag("Siren");<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">两个方法：分别控制警报声的响起和停止<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　private void PlaySiren() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　foreach (GameObject siren in sirens) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　if(!siren.audio.isPlaying) { //&nbsp;如果没有播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　　　siren.audio.Play(); //&nbsp;新版unity改用GetComponent AudioSource<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}}}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　private void StopSiren() { // 相似，但是不需判断当前是否正在播放 }<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">在Update()中，控制警报声的播放和停止<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(isAlarmOn) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　PlaySiren();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　} else {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　StopSiren();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 30px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">class</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> GameController : MonoBehaviour {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">bool</span> isAlarmOn = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> GameObject[] sirens;

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Awake() {
        isAlarmOn </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        sirens </span>= GameObject.FindGameObjectsWithTag(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">Siren</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">);
    }

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update() {
        AlarmController._instance.isAlarmOn </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">this</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">.isAlarmOn;
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (isAlarmOn) {
            PlaySiren();
        } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
            StopSiren();
    }}

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> PlaySiren() {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">foreach</span> (GameObject siren <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">in</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> sirens) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (!siren.GetComponent&lt;AudioSource&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">().isPlaying) {
                siren.GetComponent</span>&lt;AudioSource&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">().Play();
    }}}

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> StopSiren() {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">foreach</span> (GameObject siren <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">in</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> sirens) {
            siren.GetComponent</span>&lt;AudioSource&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">().Stop();
    }}
}</span></pre></div><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t5" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t5" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务8&amp;9：实时摄像机CCTV Camera &amp;&amp; 摄像机的自动旋转<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">任务10：摄像机的警报触发功能</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Prefab中可以找到 prop_cctvCam</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在环境中需要有三个cctv Camera，分别在</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/7CF077A31DBCD4AD41CE88F06C2195AB.png" alt="" width="760" height="808" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体Camera，用于放置所有cctvCamera</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">第一个camera放在bus的两桶油下方<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　摄像机的旋转（Joint）通过x和y的旋转实现，设置为低头60°<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">给摄像机添加灯光<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在cctv_cam_body上添加Light组件，Light设为Spot(探照灯)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Light的cookie设置为texture: fx_cameraView_alp，颜色改为红色<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">将cctv_collision添加进cctv_cam_body，调整位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　取消cctv_collision的renender渲染<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　给collision添加mesh collider碰撞器，用于碰撞检测<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">将上面的cctv_Camera做成prefab</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将其他两个camera分别放置</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/17CA1DE5BDBB10ABF5E80F0162981A89.png" alt="" width="968" height="746" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">摄像机的旋转</span>：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">通过Animation的方式，控制joint部分的y轴旋转</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 新建Animator -- Window-&gt;Animation-&gt;Create CameraSweepAnimation.anim</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. Add Property: Transform-&gt;Rotation</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">3. 在对应时间点上添加KeyFrame，并设置Rotation.y的值（90~0~-90）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Sample为每秒的帧数</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">4. 因为左下角的摄像机不需要进行旋转，因此不能apply to prefabs<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在另一个需要旋转的摄像机上添加Animator组件，并赋值，即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">摄像机的警报触发：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">思路：在左下角摄像机中完成警报触发功能，并apply to prefabs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 在prop_cctvCam的collision子物体上添加脚本CctvCamCollision.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 将碰撞器设置为Trigger，因为不需要有物理碰撞效果</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">3. OnTriggerEnter(Collider other) {}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(other.tag.Equals("Player")) { // 触发警报 }</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">4. 触发警报需要设置GameController.cs中的isAlarmOn<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　GameController设置为单例模式<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　public static GameController _instance;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　_instance = this;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">设置isAlarmOn：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　GameController._instance.isAlarmOn = true;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">5. 需要记录当前警报触发位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在GameController.cs中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　public Vector3 lastPlayerPos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　GameController._instance.lastPlayerPos = other.transform.position;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">6. 使用OnTriggerStay()更好，因为当Player在其中移动的时候，会触发位置更新</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t6" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t6" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务11：标签的管理（代码管理）</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">使用代码进行标签的管理（使用字符串的过程中很可能出现字符串打错等情况）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建脚本Tags.cs<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 注意：Tags不是作为一个组件存在的，只是存放了一些变量</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">public const string player = "Player";<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// const -- 常量（tags不需要修改）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">使用的时候：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(other.tag == Tags.player) {}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">还有其他tags：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　"Siren"、"Enemy"等</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t7" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t7" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务12&amp;13：添加激光警报装置 &amp;&amp; 警报的触发和闪烁</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">fx_laserfence_laser:&nbsp;<img src="resources/674105B6D6D0ECBFA79FD56CDD562B3A.png" alt="" width="368" height="178" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　调整大小、角度和位置（门柱上正好有孔，与laser一一对应）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 给laser添加Collider组件，用于碰撞检测 -- BoxCollider，选择Trigger</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 给laser添加light组件，发光：PointLight、范围变小、红色、强度增大</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">3. 给laser添加Audio Source组件: Audio-&gt;laser_ham，发声：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Spetial Blend、min/max distance、PlayOnAwake、Loop</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">4. 做成Prefab</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">5. 创建空物体lasers，放入另外五个激光警报(一共6个)即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">激光警报的触发：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">添加脚本LaserController.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">OnTriggerStay() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 和摄像头触发警报一样的操作<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 因此在GameController中写成函数public void SwitchAlarmOn(Transform t)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(tag....) GameController._instance.SwitchAlarmOn(other.transform);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Apply to prefabs.</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">激光警报的闪烁：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">两个激光（最长的那两条）需要间隔闪烁，方便Player的通过</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在LaserController中：</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">bool</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> isFlicker;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> onTime =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> 3f;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> offTime = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1.5f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> timer = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update() {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">(isFlicker) {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">this</span>.gameObject.GetComponent&lt;Renderer&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">().enabled) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 当前亮着</span>
            timer +=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Time.deltaTime;
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(timer &gt;=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> onTime) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">this</span>.gameObject.GetComponent&lt;Renderer&gt;().enabled = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
                timer </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
            }
        } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 当前暗着</span>
            timer +=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Time.deltaTime;
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(timer &gt;=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> offTime) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">this</span>.gameObject.GetComponent&lt;Renderer&gt;().enabled = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">true</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
                timer </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
}}}}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">(Collider也需要禁用和启用) --&nbsp;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; font-family: Menlo;">&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　gameObject.GetComponent&lt;BoxCollider&gt;().enabled;</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Inspector中将两个需要闪烁的激光的isFlicker属性设置为true<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">两个激光闪烁不同步，一个为(1.6, 2.8), 一个为(2.1, 2.5)（随意）</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t8" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t8" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务14&amp;15：主角和主角的动画</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">添加主角：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Models-&gt;char_ethan</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给Player添加碰撞器Capsule Collider</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给Player添加刚体Rigidbody<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因为主角不需要通过rigidbody进行移动（使用动画控制），所以勾选IsKinematic<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　(在任务16中会发现这是一个bug）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　主角在(x, z)平面上移动，且只围绕y轴旋转，所以Freeze Position: y; Rotation: x, z</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">主角移动的动画：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Humanoid中的动画是人形动画，可以使用</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">新建一个Animator Controller，名为PlayerController</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">打开Animator编辑器（选中PlayerController，Window-&gt;Animator)</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 主角的状态：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　walk/ run (walk和run是同一个动作，只不过速度不同 -- 相同动画)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　sneaker<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　idle<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　death</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 添加parameter<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　float: speed -- 移动速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　bool: sneaker -- 是否处于sneaker状态（按下shift键）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">3. 默认状态：idle<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将humanoid_idel-&gt;Idle动画拖入状态机（黄色为默认动画）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">4. 右键Create State -&gt; From Blend Tree<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　(上面提到walk和run是同一个动作，用BlendTree实现)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　命名为Locomotion (移动、运动)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　双击进入编辑模式<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Add Motion Field，添加Walk和Run动画<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Parameter中选择speed，用speed来控制walk和run的融合<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　uncheck Automate Thresholds (自动生成参数)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　取消勾选后可以手动确定：参数是根据哪个值来确定的，这里选择speed<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　<img src="resources/9586B1F50ECB82048D00F05D13C48064.png" alt="" width="538" height="1340" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　这里表示1.555在Walk，speed增大渐渐进入run的状态，5.667为run状态</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">5. Idle-&gt;Locomotion<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　make transition: Conditions: speed &gt; 0.1<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　 Locomotion-&gt;Idle: speed &lt; 0.1</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">6. Sneak: humanoid_sneak: sneak动画拖入状态机<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Idle-&gt;Sneak:<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　make transition: Conditions: speed &gt; 0.1 &amp;&amp; sneak == true;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Sneak-&gt;Idle: speed &lt; 0.1</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">7. Locomotion-&gt;Sneak:<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　speed &gt; 0.1 &amp;&amp; sneak == true;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　 Sneak-&gt;Locomotion:<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　speed &gt; 0.1 &amp;&amp; sneak == false;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">由于player的移动是通过动画实现的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因此如果觉得移动过慢/快，可以修改对应状态的speed</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">8. Dying: humanoid_dying-&gt;Dying<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加parameter: bool dead<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因为任何状态下都会死亡 --<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　AnyState-&gt;Dying: make transition: dead = true;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/6E5523E28C68EDF1EB18EE803E68DD56.png" alt="" width="798" height="224" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t9" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t9" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务16&amp;17：控制主角的运动和移动</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">运行游戏，手动调整主角的速度，会发现主角出现了移动，主角的transform也发生变化<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　由于Player-&gt;Animator勾选了属性Apply Root Motion，表示动画会影响transform的值</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">思路：按下上下左右键时，设置speed即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　根据按键控制朝向</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在char_ethan添加脚本PlayerController.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Update()中实现：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 得到按键的信息<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">float h = Input.GetAxis("Horizontal");<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">float v = Input.GetAxis("Vertical");</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 需要得到Animator来改变speed的值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private Animator anim = GetComponent...</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">(我的思路)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　anim.SetFloat("Speed", (Mathf.Max(h,v) * 5.56f));<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- 结果为不适合<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　1.&nbsp;数值变化太快，walk-&gt;run过于迅速<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　2.&nbsp;而且延迟较大，Input.GetAxis()的值需要时间来归零和增大</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">(正确思路 -- 利用差值)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(Mathf.Max(Mathf.Abs(h), Mathf.Abs(v)) &gt; 0.1f) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 开始移动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　newSpeed = Mathf.Lerp(anim.GetFloat("speed"), maxSpeed, delta...)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　} else { // 停止移动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 相同思路，利用差值，但是将speedRate增大，因为需要很快停止移动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 试验过后发现还是不好控制，于是直接将speed设为0<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 但是从跑步到Idle的动画很不平滑 -- 自行选择<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　newSpeed = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　anim.SetFloat("speed", newSpeed);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">出现bug -- Player会进行穿墙，就好像Collider没有任何作用一样<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　原因：任务14中给Player添加Rigidbody时勾选了IsKinemetic选项，取消勾选即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">控制Player的移动方向：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在需要移动的if条件中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 取得目标方向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3 targetDir = new Vector3(h, 0, v);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 取得当前方向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3 currDir = transform.forward;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 取得两个方向的夹角<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　float angle = Vector3.Angle(targetDir, currDir);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 使用匀速旋转的方法<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　transform.Rotate(Vector3.up * angle * Time.deltaTime * rotateSpeed);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// rotateSpeed可设为5</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">到此为止player的移动功能实现了，但是<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　出现Bug --&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 角色在停止控制后有的时候会继续不听旋转<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　(个人推测是惯性？)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将角色的Rotation: y Freeze即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 拐弯的时候会出现有的时候往大弯绕<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　比如：角色朝左，向下控制，角色会通过上右下而向下移动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　angle的值也是从90变大到180再变小<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　细心观察会发现，角色永远是顺时针旋转<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　原因：Vector3.Angle()返回值没有正负，小于180°<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　Rotate(...)方向为Vector3.up，因此永远是顺时针旋转<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　　而旋转一些以后，angle值变大，需要继续旋转，直到angle值为0<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法 -- 想不出如何判断使用Vector3.up还是Vector3.down<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　舍弃该方法<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　使用Quaternion和Slerp来解决<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Quaternion targetQuaternion = Quaternion.LookRotation(targerDir);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 四元数返回的是一个带有方向的角度 (该函数默认以Vector3.up为上方)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　transform.rotation = Quaternion.Slerp(transform.rotation,&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　targetQuaternion, Time.deltaTime * rotationSpeedRate);</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Animator animator;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> increaseSpeedRate = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">2.5f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> decreaseSpeedRate =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> 60f;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> rotateSpeedRate = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">2</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> newSpeed;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">const</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> maxSpeed = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">5.66f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Awake() {
    animator </span>= GetComponent&lt;Animator&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">();
}

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update() {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> h = Input.GetAxis(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">Horizontal</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">);
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> v = Input.GetAxis(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">Vertical</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">);
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (Mathf.Max(Mathf.Abs(h), Mathf.Abs(v)) &gt; <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.1f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 开始移动</span>
        newSpeed = Mathf.Lerp(animator.GetFloat(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">), maxSpeed, 
            Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> increaseSpeedRate);
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 开始旋转
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 取得目标方向</span>
        Vector3 targetDir = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">new</span> Vector3(h, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, v);
        Quaternion targetDirQuaternion </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Quaternion.LookRotation(targetDir);
        transform.rotation </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Quaternion.Slerp(transform.rotation, 
            targetDirQuaternion, Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> rotateSpeedRate);
    } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 停止移动</span>
        newSpeed = Mathf.Lerp(animator.GetFloat(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span>), <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, 
            Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> decreaseSpeedRate);
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> newSpeed = 0;</span>
<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">    }
    animator.SetFloat(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, newSpeed);
}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">实现sneak缓慢行走：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">if(Input.GetKeyDown(KeyCode.LeftShift)) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　anim.SetBool("sneak", true);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(Input.GetKeyUp(KeyCode.LeftShift)) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　anim.SetBool("sneak", false);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">会发现，从Idle时按住shift后再按方向键，刚开始一小小段时间会进行walk而不是sneak<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">解决方法 --&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将动画状态机中Idle-&gt;Locomotion的condition加上sneaker=false;即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">此时sneak的速度有点慢<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　控制sneak的动画播放速度即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　选中动画状态机中的sneak，将inspector中的speed加大即可</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t10" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t10" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务18：主角行走声音和游戏背景音乐</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">添加背景音乐：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在GameController中添加AudioSource: music_normal，PlayOnAwake，Loop，2D</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">添加行走声音：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在主角上添加AudioSource: player_footsteps</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在PlayerController.cs中添加两个方法</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">void PlayFootstepsAudio() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(!audio.isPlaying) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　audio.Play();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">void StopFootstepsAudio() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　audio.Stop();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Locomotion的状态下需要播放声音，其他状态不要</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">if(anim.GetCurrentAnimatorStateInfo(0).IsName("Locomotion")) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// play audio<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">} else {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// stop audio<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">切换背景音乐：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当警报被触发的时候，背景音乐会从music_normal切换至music_panic<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">思路：如果直接暂停播放会显得比较突兀，因此使用对两个Volume进行差值运算的方法</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在GameController上添加另一个AudioSource: music_panic, Loop</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在GameController.cs中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　定义两个AudioSource来存放两个声音<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Update()中修改两个AudioSource的Volume<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在原有的isAlarmOn判断下<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　musicNormal.volume=Mathf.Lerp(musicNormal.volume, 0, Time.deltaTime);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　musicPanic.volume=Mathf.Lerp(musicPanic.volume, 1, Time.deltaTime);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　!isAlarmOn时也类似<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　也可以添加一个musicFadeSpeed来控制渐变速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Panic的背景声音有点大，因此改为0.5f</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t11" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t11" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务19：添加自动门</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">自动门机制：当主角靠近门的时候会门会自动打开: door_generic_slide<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　门的模型都自带两个动画 open和close</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体，用于存放所有门</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">使用Animator状态机进行门的控制<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　新建Animator，名为normalDoorAnimationController<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将两个动画拖入状态机 -- 默认为close状态，设为default<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加Parameters: bool closing; // 当closing为true时，进行关闭，为false时进行开启<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　closing初始值为true<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加状态close和open之间的transition</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给door_generic_slide-&gt;door_generic_slide_panel 添加BoxCollider来检测碰撞<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">给door_generic_slide添加sphere collider，用于trigger开门动画</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在door上添加DoorController.cs脚本 -- 代码控制门的开关<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因为是控制门的开关，因此如果是Enemy或Player在触发区内，保持开门状态<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　OnTriggerStay(Collider other) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(other.tag == Tags.Player || ... == Tags.Enemy) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　anim.SetBool("closing", false);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 那如何关门呢？OnTriggerExit()? 不行，如果区域内有两个人的话，怎么解决？<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 使用count来计数 -- 就不能用OnTriggerStay了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　OnTriggerEnter(...) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(other.tag ... || ... ) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　count++;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　OnTriggerExit(...) { // 相同情况 count--; }</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　在Update中用count来判断是否开关门<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doorAnimator.SetBool("closing", (count&lt;=0));</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">添加开关门的声音：打开和关闭时播放声音<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在门上添加AudioSource: door_open<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Update中更改doorAnimator.closing时<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 播放声音<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(anim.IsInTransition(0) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 如果在0 layer中正在进行某个Transition<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　audioDoorOpen.Play();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将门做成Prefab，并创建其他两扇门</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t12" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t12" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务20：添加电梯门 -- 设置内侧外侧打开和关闭动画</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">电梯的自动门是两扇，往两边打开<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　电梯门分为外侧和内侧两扇门（内侧门即电梯，跟随上下移动的）</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">添加外侧门</span>：door_exit_outer</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">相同的，分别给door_exit_outer_left和right添加上BoxCollider<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　给door_exit_outer添加上SphereCollider作为Trigger<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　AudioSource为door_open</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">外侧门的控制代码使用上一任务的DoorController.cs即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Animator使用上一任务的NormalDoorController即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- 复制一个AnimatorController，并将状态中的动画(Motion)换成对应的动画<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　&nbsp; door_exit_outer_close和door_exit_outer_open</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">添加内侧门</span>：prop_lift_exit</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">注意电梯门的方向 prop_lift_exit-&gt;door_exit_inner</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Lift上添加脚本LiftController.cs<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 让inner door的z轴坐标跟随outer door的x轴坐标变化即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 首先得到是个transform: inner_door和outer_door的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; font-family: 宋体;">　　innerDoorLeft.position&nbsp;=&nbsp;new&nbsp;Vector3(outerDoorLeft.position.x,&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　innerDoorLeft.position.y,&nbsp;innerDoorLeft.position.z);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;innerDoorRight.position&nbsp;=&nbsp;new&nbsp;Vector3(outerDoorRight.position.x,&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　innerDoorRight.position.y,&nbsp;innerDoorRight.position.z);</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">内侧门的开关实现了，但是速度会比较快，因此采用另一种方法 -- Lerp<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　newInnerDoorLeftX&nbsp;=&nbsp;Mathf.Lerp(innerDoorLeft.position.x,&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　outerDoorLeft.position.x,&nbsp;Time.deltaTime);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">再给内侧门左右加上BoxCollider</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t13" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t13" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务21：对电梯门添加钥匙控制</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">因为两种门共用一个脚本DoorController.cs<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　使用一个bool keyRequired = false; 来判断该门是否需要钥匙?打开<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在PlayerController.cs中使用bool hasKey=false; 来记录当前是否拥有钥匙</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　修改DoorController.cs中OnTriggerEnter部分：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　如果该门需要key，且collider为Player，且身上有key，才进行count++<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- enemy在需要key的门前不会使其打开</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　　　if(keyRequired) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　if(other.tag == Tags.player) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　　　if(other.gameObject.getcomponent&lt;...script...&gt;().GetHasKey()) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　　　　　count++;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　}}} else { // normal door }</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　对于OnTriggerExit() 也一样需要相同的判断，否则会平白无故count--;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　-- 小小不算bug的bug -- 在Trigger内部修改hasKey，就再也不能开门了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　逻辑，修改hasKey后出去, count--, count=-1, 再进去, count++, count=0;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将电梯外门的keyRequired勾选上即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当没有钥匙的人接近了门的时候，需要播放AudioSource: door_accessDenied</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　判断是否Player有钥匙后<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　else {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　GetComponents&lt;AudioSource&gt;()[1].Play();　　</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t14" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t14" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务22：主角拾起钥匙的功能</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Models-&gt;prop_key_card</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">放置在这个位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　<img src="resources/530CFFC948C2384DE5AC216908462520.png" alt="" width="760" height="656" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给Key添加Light，蓝色，intensity调大</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建Animator: KeyCardController<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将key_card中自带的默认动画spin拖入状态机即可 -- key的旋转动画</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给Key添加Sphere Collider，用来作为Trigger，检测主角是否到达拾起钥匙的区域</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给Key添加脚本KeycardController.cs<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　OnTriggerEnter(...) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// Player进入触发区时，拾起钥匙<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　PlayerController player = other.GetComponent&lt;PlayerController&gt;();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　player.hasKey = true;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 播放得到钥匙的声音<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- 给Key添加一个AudioSource: keycard_pickUp<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　通过audioSource.Play() 能行吗？不行，因为this已经被Destroy了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　解决方法：AudioClip --&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　public AudioClip audio;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 在transform.position处播放audioClip<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　AudioSource.PlayClipAtPoint(audio, transform.position);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 销毁钥匙<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Destroy(this.gameObject);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t15" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t15" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务23：激光的开关控制</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">游戏机制：一个电闸开关控制一个激光，Player在电闸旁边按下z来关闭对应激光</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/FD276036BA06243C1D84B4460F2F6C32.png" alt="" width="900" height="730" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体switchUnits，用来存放所有(4个)开关</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">关闭开关后，激光会消失，开关上面锁的显示会改变(改变材质即可)</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/E232F61911E05CE8C02AC0933B16BB3C.png" alt="" width="364" height="406" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">给SwitchUnit添加BoxCollider防止Player走进去<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加BoxCollider作为Trigger -- Sphere不合适，在墙外也能触发<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加AudioSource: switch_deactivation -- 解锁声音</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">添加脚本SwitchUnitController.cs控制开关逻辑</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">OnTriggerStay() { -- 需要在触发区域内<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(other.tag == Tags.player) { -- 如果是Player进入<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(Input.GetKeyDown(KeyCode.z)) { -- 如果按下了z键<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 关闭对应激光 -- public GameObject laser;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　laser.SetActive(false);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 播放声音<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　audio.Play();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 修改解锁标志 -- 替换material -- public Material unlockedMaterial;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　transform.Find("prop_switchUnit_screen").<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　　　GetComponent&lt;MeshRenderer&gt;().material = unlockedMaterial;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}}}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">-- 小Bug：在触发区域内多次按下z键，会进行多次的音效播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法(个人)：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　定义一个bool isSwitchValid = true<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在OnTriggerStay最外层用if(isSwitchValid) 判断即可</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将其做成Prefab，添加其他四个SwitchUnit</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 30px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> OnTriggerStay(Collider other) {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 需要在触发区域内</span>
    <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (isSwitchValid) {
       </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (other.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 如果是Player进入</span>
            <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (Input.GetKeyDown(KeyCode.Z)) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 按下z键
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 关闭对应激光 -- public GameObject laser;</span>
                laser.SetActive(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">);
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 播放声音</span>
<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">                unlockedAudio.Play();
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 修改解锁标志(替换material) - public Material unlockedMaterial;</span>
                transform.Find(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">prop_switchUnit_screen</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">).
                    GetComponent</span>&lt;MeshRenderer&gt;().material =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> unlockedMaterial;
                isSwitchValid </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
}}}}</span></pre></div><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t16" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t16" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务24&amp;25&amp;26：摄像机的跟随移动 &amp;&amp; 摄像机的视野问题 &amp;&amp; 摄像机的缓动</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">按F聚焦Player，在Scene视图下调整好合适的视角<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　选中MainCamera，GameObject-&gt;Align With View -- 将Camera设置为当前视角</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">摄像机的跟随移动</span>：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　会利用很多Lerp差值运算</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在摄像机上添加脚本 FollowPlayer</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 得到相机和Player之间位置的offset<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private Transform player = GameObject.FindWithTag(Tags.player).transform;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private Vector3 offset = tranform.position - player.position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">offset = new Vector3(0, offset.y, offset.z); // 保持x方向值相等</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 在Update中更新Camera位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">transform.position = player.position + offset;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">出现问题：若主角在下侧墙的上方，则视野会被墙挡住<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">--改进相机的视野实现</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">摄像机的视野智能化调整：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">解决思路：从Camera发射射线到Player，如果射线没有接触到Player，则旋转<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　如何旋转？得到Player正上方的距离为offset的点，在该点和Camera之间等距划分<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　三点，依次判断这三点是否符合要求，若符合，调整Camera位置和方向</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">代码实现：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 起始点<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Vector3 beginPos = player.position + offset;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">// 终点 -- Player正上方点<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Vector3 endPos = player.position + offset.magnitude * Vector3.up;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 得到两点之间的四等分点 (3个点) -- 用向量运算方法或差值方法均可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Vector3 pos1 = Vector3.Lerp(beginPos, endPos, 0.25f);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">其余的为pos2 = ... 0.5f;&nbsp; pos3 = ... 0.75f;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">存放在数组中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Vector3[] posArray = new Vector3[5];</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 判断在哪个点可以看到Player -- 用射线的方法<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">foreach(Vector3 pos in posArray) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 遍历所有可能位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　RaycastHit hitInfo;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(Physics.Raycast(pos, player.position - pos, out hitInfo) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 如果有碰撞的话<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(hitInfo.collider.tag == Tags.player) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 如果在视野内能看到Player -- 移动摄像机<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　transform.position = pos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 改变摄像机的朝向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　transform.LookAt(player.position);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　break;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}}}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">现在，摄像机的视角问题解决了，但是摄像机需要进行缓动，不然会显得卡顿 -- Lerp&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">摄像机的缓动：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将上面的transfrom.position = pos; 改为<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">transform.position = Vector3.Lerp(transform.position, pos, Time.deltaTime);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将上面的transform.LookAt(player); 改为<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Quaternion currQuaternion = transform.rotation;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">transform.LookAt(player);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">transform.rotation = Quaternion.Slerp(currQuaternion, transform.rotation,&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Time.deltaTime);</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Transform player;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3 offset;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> cameraMovingSpeed = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">2</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> cameraRotateSpeed = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">10</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Start() {
    player </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> GameObject.FindWithTag(Tags.player).transform;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 保持在x轴方向值相同</span>
    offset = transform.position -<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> player.position;
}

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update() {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 得到起始点和终点</span>
    Vector3 beginPos = player.position +<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> offset;
    Vector3 endPos </span>= player.position + offset.magnitude *<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.up;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 得到四等分点</span>
    Vector3[] posArray = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">new</span> Vector3[<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">5</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">];
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> lerp = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.25f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> currLerp = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">for</span> (<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">int</span> i = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span>; i &lt; posArray.Length; i++<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
        posArray[i] </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Lerp(beginPos, endPos, currLerp);
        currLerp </span>+=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> lerp;
    }
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 判断哪个点是适合的</span>
    <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">foreach</span> (Vector3 pos <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">in</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> posArray) {
        RaycastHit hitInfo;
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(Physics.Raycast(pos, player.position - pos, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">out</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> hitInfo))
        Debug.DrawRay(pos, player.position </span>-<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> pos);
        print(hitInfo.collider);
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(hitInfo.collider.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 在视野内能看到Player</span>
            transform.position =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Lerp(transform.position, pos, 
                Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> cameraMovingSpeed);
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 改变摄像机的朝向 -- 使用Quaternion的差值进行转向</span>
            Quaternion currQuaternion =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> transform.rotation;
            transform.LookAt(player);
            transform.rotation </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Quaternion.Slerp(currQuaternion, 
                transform.rotation, Time.deltaTime </span>*<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> cameraRotateSpeed);
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">break</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
}}}}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">后期运行发现bug -- 当Player走到cctv_Cam下的collider的时候，也会导致camera视角变化<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　将hitInfo.collider.tag == Tags.player修改为<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　hitInfo.colllider.tag == Tags.player || hitInfo.collider.tag == Tags.cctvCollider</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t17" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t17" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务27：Navigation自动寻路导航网格</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">机器人的自动导航系统 --&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">把env_stealth_static和battle_bus设置为static (Navigation bake的目标)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Window-&gt;Navigation-&gt;Bake-&gt;Bake</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">检查一下自动生成的区域是否正确 -- 发现网布下方的通路没有打开</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/1708EDA77073CB606FB01BDDBE1DCAF8.png" alt="" width="914" height="718" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">减小Agent Radius (增大区域的面积，离突起物更近的地方也可被视作可用区域)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">减小Agent Height<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Slope=0；因为在该场景下，是平面的，无需设置坡度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">StepHeight=0；高度差小于这个值的，视为通路</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t18" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t18" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务28：添加机器人</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Enemy: char_robotGuard -- AI实现、动画实现、射击实现等等</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. 防止碰撞墙体等<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加碰撞器 Capsule Collider<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加Rigidbody</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 实现导航功能 -- 判断机器人当前应该去的方向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加Nav Mesh Agent组件<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Radius 自身宽度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Speed 移动速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Acceleration 加速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　AngularSpeed 旋转速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　等等<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　注：NavMeshAgent是可以控制运动的（直接设置position）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　但是由于动画也会控制运动，故不使用</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">3. 实现发现Player功能 -- 即机器人视野和听觉<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加Sphere Collider作为Trigger<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　当Player在Trigger之内，会进行机器人视野的检测</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将机器人做成Prefab</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t19" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t19" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务29：设置机器人的状态机（动画效果）</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建Animator，名为EnemyController</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">BaseLayer -- Idle, Locomotion,<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">将动画humanoid_idle拖入状态机，set as default<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">创建BlendTree，名为Locomotion，表示机器人的运动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　机器人运动动画：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Walk/Run, Walk/RunLeft/RightShort/Medium/Wide<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　TurnOnSpotLeft/RightA/B/C/D<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　将这些动画都添加如BlendTree的motion中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　参数为speed和rotation，因此为2d的BlendTree<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　将BlendType改为2D Freeform Cartesian<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Compute Positions = Speed and AngularSpeed，数值会自动生成&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 120px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/0AC0E595FCC53CB45E34AF419310DBFA.png" alt="" width="560" height="960" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　可以看出来，每个点代表一个动画状态，<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　PosX表示转向速度，PosY表示行走速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　比如竖直中间两个点上面的为Run，下面的为Walk</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">需要两个Float Parameter变量分别对应AngularSpeed: PosX和Speed: PosY</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">发现Idle其实应该在Locomotion中，而不是单独存在<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　删除Idle状态，将Idle动画添加到Locomotion中</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">射击动画：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　weapon_lower/weapon_raise/weapon_shoot<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　增加一个Layer，称为Shoot<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加一个bool Parameter: playerInSight，用来判断是否处于射击状态<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加一个Empty状态作为默认状态 default<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　transition: default -&gt; weapon_raise :&nbsp;playerInSight&nbsp;= true<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　transition: weapon_raise -&gt; weapon_shooting : 没写condition时表示接着播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　这里也可以写上playerInSight=true作为条件，表示raise后如果还是true才射击<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　如果为false了就不进行射击了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　transition: weapon_raise -&gt; weapon_lower : playerInSight = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　transition: weapon_shoot -&gt; weapon_lower :&nbsp;playerInSight = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　如果playerInSight依然为true，则会进行循环播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　transition: weapon_lower -&gt; default : no condition</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">因为射击动画只控制了手的动作而没有控制身体<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因此需要创建一个身体遮罩<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Project中create-&gt;Avatar Mask，命名为EnemyShootMask<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Inspector中选择Humanoid，将全身禁止只留下双手和头部</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 120px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/2284B7885B4F477D8CD6E5664CED058B.png" alt="" width="476" height="788" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">点击状态机的Shoot Layer旁边的设置按钮，将EnemyShootMask赋值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　<img src="resources/FD2432A0621DB4F44AF90474CB3DB9B9.png" alt="" width="868" height="268" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因为这一Layer权重比上一层高，所以Weight = 1，并选用Override</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t20" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t20" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务30：机器人的听觉和视觉</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">听觉：Sphere Collider<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">视觉：前方锥形范围 110°</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">添加脚本EnemySight.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private bool isPlayerInSight = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private float viewFieldAngle = 110;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">视觉：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当主角在SphereCollider范围内 -- 在OnTriggerStay() 中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(other.tag = player) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 得到两个方向：enemy前方和enemy朝向player的方向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3 forward = transform.forward;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3 playerDir = other.transform.position - transform.position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　float tempAngle = Vector3.Angle(forward, playerDir);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 判断是否在锥形视野范围之内<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(tempAngle &lt;= viewFieldAngle * 0.5) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　playerInSight = true;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　} else {&nbsp;playerInSight = false; }<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当主角不在SphereCollider范围内（不在听觉范围内） -- OnTriggerExit()&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(other.tag == player) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　playerInSight = false; // 出了这个范围肯定是看不到了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">听觉：机制 -- 两点之间可通路的最短距离(Navigation)，即墙等障碍物是完全隔音的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　听到声音后，会设置警报位置，让Enemy去追踪</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">存储当前警报位置 -- 被发现的Player位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">public Vector3 alertPosition = Vector3.zero; // 需要被外界使用，默认为zero<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">在上面Player被看到时，playerInSight=true;后加上 alertPos=other.transform.position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　同理，playerInSight=false;后加上&nbsp;alertPos=Vector3.zero; // 归零</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在TriggerStay中（因为Trigger就是表示可以听到声音的范围）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">// 判断player是否处于Locomotion状态<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(playerAnim.GetCurrentAnimatorStateInfo(0).IsName("Locomotion")) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 使用NavMeshAgent判断最短路径距离<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// private NavMeshAgent navAgent = GetComponent&lt;NavMeshAgent&gt;();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 因为navAgent.CalculatePath(targetPos, navMeshPah), 需要一个空Path传入<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- calculate a path to a specified point and stored the resulting path<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　&nbsp; return a bool if there is a path<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　NavMeshPath navPath = new NavMeshPath();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// navPath.corners，为一个存放所有路径拐点的Vector3数组<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(navAgent.CalculatePath(other.transform.position, navPath)) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3[] waypoints = new Vector3[navPath.cornors.Length+2];</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 120px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 给所有路径点赋值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">waypoints[0] = transform.position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">waypoints[waypoints.Length-1] = other.transform.position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">for(int i = 1; i &lt; waypoints.Length - 1; i++) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　waypoints[i] = navPath.corners[i-1];<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 120px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 计算总长度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">float totalDistance = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">for(int i = 1; i &lt; waypoints.Length; i++) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 从第二个点开始，计算与前一个点之间的距离<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　totalDistance += (waypoint[i-1] - waypoint[i]).magnitude;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 120px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 总长度与最大长度进行比较，判断是否在最大距离之内<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private SphereCollider sphereCollider = GetComponent&lt;...&gt;();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(totalDistance &lt;= sphereCollider.radius) { // 可以听到<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　alertPosition = other.transform.position;</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 30px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> OnTriggerStay(Collider other) {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(other.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> Player进入听觉视觉触发区域
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 得到两个方向：enemy前方和enemy朝向player的方向</span>
        Vector3 forward =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> transform.forward;
        Vector3 playerDir </span>= other.transform.position -<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> transform.position;
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> tempAngle =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Angle(forward, playerDir);
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 判断是否在锥形视野范围之内</span>
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(tempAngle &lt;= viewFieldAngle * <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.5f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
            playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">true</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 更新警报位置</span>
            alertPosition =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> other.transform.position;
        } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
            playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
            alertPosition </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.zero;
        }

        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 听觉实现 -- 通路距离在给定范围之内，则进行追踪</span>
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (playerAnim.GetCurrentAnimatorStateInfo(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span>).IsName(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">Locomotion</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">)) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 若当前Player状态为Locomotion -- 有声音发出</span>
            NavMeshPath navPath = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">new</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> NavMeshPath();
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> (navAgent.CalculatePath(other.transform.position, navPath)) {
                Vector3[] waypoints </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">new</span> Vector3[navPath.corners.Length + <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">2</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">];
                waypoints[</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span>] =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> transform.position;
                waypoints[waypoints.Length </span>- <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span>] =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> other.transform.position;
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">for</span> (<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">int</span> i = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span>; i &lt; waypoints.Length - <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span>; i++<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
                    waypoints[i] </span>= navPath.corners[i - <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">];
                }
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 计算路径总长度</span>
                <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> totalDistance = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">for</span> (<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">int</span> i = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span>; i &lt; waypoints.Length; i++<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
                    totalDistance </span>+= (waypoints[i-<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1</span>]-<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">waypoints[i]).magnitude;
                }
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 判断是否在最大距离内 -- 最大距离即为SphereCollider的半径</span>
                <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (totalDistance &lt;=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> sphereCollider.radius) {
                    alertPosition </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> other.transform.position;
}}}}}

</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> OnTriggerExit(Collider other) {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(other.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
        playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        alertPosition </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.zero;
}}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">运行，听觉和视觉都正常运行<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Bug1: 但是，因为SphereCollider的关系，Camera.FollowPlayer()中需要加上另一个条件<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　hitInfo.collider.tag == Enemy</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　Bug2: 机器人移动到门附近的时候，因为SphereCollider范围很大，会触发门的开关<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　而只有当CapsuleCollider进入的时候才会触发门的开关<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　改为：if(tag... &amp;&amp; other.GetType().ToString()=="UnityEngine.CapsuleColiider")<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　或: if&nbsp;(other.tag&nbsp;==&nbsp;Tags.enemy&nbsp;&amp;&amp;&nbsp;<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">other&nbsp;is&nbsp;CapsuleCollider</span>)&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　或:&nbsp;if&nbsp;(other.tag&nbsp;==&nbsp;Tags.enemy&nbsp;&amp;&amp;&nbsp;<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">other.isTrigger == false</span>)&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　即可</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t21" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t21" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务31：机器人发起警报的功能</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">警报机制：当Enemy看到Player时，通知其他机器人进行追踪<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　看到或听到都会更新警报发出位置</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">记得之前在GameController中有一个警报方法SwitchAlarmOn将isAlarmOn设置为true</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">那么，在EnemySight.cs中，<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　当isPlayerInSight为true时，加上一句:<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　GameController._instance.SwitchAlarmOn(other.transform); // 将player位置传递</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">实现了Enmey看到Player时，开启警报<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">还需实现追踪功能<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　机制：alertPos不等于Vector3.zero时，就进行追踪<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　而且，GameController中的lastPlayerPos修改时 (其他警报器)，也要进行追踪</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当lastPlayerPos修改时，更新<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// （Awake()中）用来存储之前的lastPlayerPos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　private Vector3 preLastPlayerPos = GameController._instance.lastPlayerPos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 进行检测 -- Update()中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(preLastPlayerPos != GameController._instance.lastPlayerPos) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　alertPosition =&nbsp;GameController._instance.lastPlayerPos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　preLastPlayerPos = alertPosition;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">报错：<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; font-family: 宋体;">&nbsp;preLastPlayerPosition&nbsp;=&nbsp;GameController._instance.lastPlayerPos;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　</span>原因：GameController.cs中_instance = this的赋值在Awake()中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　而preLastPlayerPos这句话的赋值也是在Awake()中且用到了_instance<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　因此可能会出现空指针的错误<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; font-family: 宋体;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"></span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; font-family: 宋体;"><img src="resources/474F7DD127D2251BA801AC188F3866D8.png" alt="" width="890" height="36" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">解决方法：将preLastPlayerPos的赋值放在Start()中</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">现在可以通过cctvCam和laser触发警报并修改alertPosition的值，<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Bug -- 在cctvCam中移动不会更新lastPlayerPos：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　cctvCamCollision.cs中的触发条件改为OnTriggerStay() 而不是OnTriggerEnter()</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- 在SphereCollider之内且playerInSight=false时，alertPosition会被强制设为zero<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　因为在两个else情况下，把alertPosition设置为了Vector3.zero<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法：去掉OnTriggerStay中的设置即可，OnTriggerExit需要设置为zero</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t22" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t22" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务32&amp;33：使用Navigation控制机器人的巡逻 &amp;&amp; 行走的动画</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体waypoints，用来存储巡逻的路径点<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在里面创建若干个空物体waypoint -- 用来表示路径的下一个临时目标位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　分别在Scene中设置position<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　但是空物体在环境中是没有图标表示的，因此不好观察<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在Inspector中物体名的左边可以选择icon-&gt;other-&gt;waypoint</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><img src="resources/6D0BD9FBF1CCD3B9216AD7BAE22D5A3C.png" alt="" width="1064" height="878" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">注意：使用NavMeshAgent进行控制，是直接设置transform的</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建脚本EnemyMoveAI.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">// 定义数组，存储waypoints的位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">public Transform[] waypoints = new Transform[4];<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private int index = 0; // 当前目标索引</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">巡逻的方法：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private void Patrolling() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- 机制：巡逻到达一个waypoint后，需要休息一段时间，再去下一个waypoint<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- private float patrolTimer = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- private float patrolWaitingTime = 3;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 需要使用NavMeshAgent进行路径导航<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- private NavMeshAgent navAgent = GetComponent&lt;...&gt;();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- Awake()中，设<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">navAgent.destination</span>&nbsp;= waypoints[index].position; //index=0<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 检测有没到达目标位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">navAgent.remainingDistance</span>&nbsp;&lt; 0.5f) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 休息<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">navAgent.isStoped = true</span>;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　patrolTimer += Time.deltaTime;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(patrolTimer &gt;= patrolWaitingTime) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 休息完毕，下一个点<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 一共四个点，循环播放，index不能超过三<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　index++;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　index %= 4;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　navAgent.destination = waypoints[index].position;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　navAgent.isStoped = false; // 开始进行下一个点的寻路<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　patrolTimer = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">现在，机器人可以进行四个点的巡逻的，但是，没有行走动画的播放，仅仅是位置的移动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　NavMeshAgent提供的寻路为直接修改transform的，我们利用它的指向功能<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　结合动画，来实现动画版的巡逻</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将NavMeshAgent的位置控制取消<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　navAgent.updatePosition = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　navAgent.updateRotation = false;&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">新建脚本EnemyAnimationController.cs -- 通过控制状态机来控制行动</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private NavMeshAgent navAgent = GetComponent&lt;...&gt;();</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Update()里<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">navMesh.desiredVelocity</span>&nbsp;// 期望速度 -- 当前移动的速度和方向<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">思路：navMesh的期望速度设置给用来控制动画状态机的Speed和AngularSpeed</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">当休息时（即navAgent.isStopped = true)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(navAgent.desiredVelocity = Vector3.zero) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　enemyAnim.SetFloat("speed", 0);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　enemyAnim.SetFloat("angularSpeed", 0);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 注意 重载 SetFloat(name, value, dampTime, deltaTime)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　dampTime: 阻尼时间，在该时间内，将name逐渐设置为value，渐变过程<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 直接设置，动画有时候会显得突兀，这里先不用，看看效果不好再用<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">} else {&nbsp; -- 行走状态</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　// 计算角度AngularSpeed<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　float angle = Vector3.Angle(transform.forward, navAgent.desiredVelocity);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// anim中的AngularSpeed为弧度值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　float angleRad = Mathf.Deg2Rad * angle;&nbsp; // Dot = 2PI/360<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 算出弧度的方向（正负） -- 根据动画来说，右转为正<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　--&nbsp;<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">Vector3.Cross(a,b)</span><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　方向：应用左手定则，result向量(中指)分别垂直于a(拇指)和b(食指)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　大小：为a和b大小的乘积<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　思路：通过Cross的方向即可得angleRad的正负：向上为正，向下为负<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Vector crossResult = Vector3.Cross(...forward, ...desiredVelocity);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(crossResult.y &lt; 0) {&nbsp;angleRad&nbsp;= -angleRad; }<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　anim.SetFloat("angularSpeed", angularSpeed);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">思路：当角度大于九十度时，没必要往前走了，便设定为原地旋转，</span><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">　　　　　当角度小于九十度时，边走边旋转</span><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(angle &gt;= 90) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　anim.SetFloat("speed", 0);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　} else {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 计算当前速度<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　<img src="resources/0AE71DBF980355970F6BAC0B25B5926A.png" alt="" width="1096" height="1050" style="box-sizing: border-box; outline: none; border: 0px; word-wrap: break-word; cursor: zoom-in;"><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// ab为当前朝向，ac为desiredVelocity<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 当前速度设为ac在ab方向上的分速度ad即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　慢慢加快速度，动画会平滑很多<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　--&nbsp;<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">Vector3.Project(vector, onNormal)</span>&nbsp;:&nbsp;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　&nbsp; 返回vector在onNormal方向上的分向量projection<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　Vector3 projection = Vector3.Project(...desiredVelocity, ...forward);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　anim.SetFloat("speed", projection.magnitude);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">Bug -- NavMeshAgent的位置与机器人的位置分离了</span><br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Siki上没有出现这个情况<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　同样的问题：http://tieba.baidu.com/p/5313022190?traceid=<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法：在Update() 最后将NavMeshAgent的位置设置为transform的位置即可<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　navAgent.nextPosition = transform.position;</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 30px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">class</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> EnemyAnimationController : MonoBehaviour {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> speedDampTime = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.3f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> angularSpeedDampTime = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.3f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Animator enemyAnim;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> NavMeshAgent navAgent;

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Awake () {
            enemyAnim </span>= GetComponent&lt;Animator&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">();
            navAgent </span>= GetComponent&lt;NavMeshAgent&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">();
    }
    
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update () {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 如果navAgent.isStopped = true -- 休息状态</span>
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(navAgent.desiredVelocity ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.zero) {
            enemyAnim.SetFloat(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span>, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, speedDampTime, Time.deltaTime);
            enemyAnim.SetFloat(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">angularSpeed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span>, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, 
                angularSpeedDampTime, Time.deltaTime);
        } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 行走状态
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 旋转角度大小</span>
            <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> angle =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Angle(transform.forward,         
                navAgent.desiredVelocity);
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> angleRad = angle *<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Mathf.Deg2Rad;
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 旋转角度方向</span>
            Vector3 crossResult =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Cross(transform.forward, 
                navAgent.desiredVelocity);
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(crossResult.y &lt; <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span>) { <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 左转</span>
                angleRad = -<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">angleRad;
            }
            enemyAnim.SetFloat(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">angularSpeed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, angleRad, 
                angularSpeedDampTime, Time.deltaTime);
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 两种情况，角度大于90时，原地旋转；小于90时，边走便旋转</span>
            <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(angle &gt;= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">90</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 原地旋转</span>
                enemyAnim.SetFloat(<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span>, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, speedDampTime, Time.deltaTime);
            } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 计算speed -- desiredVelocity在当前方向forward上的分速度</span>
                Vector3 projection =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Vector3.Project(navAgent.desiredVelocity, 
                    transform.forward);
                enemyAnim.SetFloat(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">speed</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">, projection.magnitude, 
                    speedDampTime, Time.deltaTime);
            }
        }
        navAgent.nextPosition </span>=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> transform.position;
    }
}</span></pre></div><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t23" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t23" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务34：机器人的追捕 AI</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">机器人的三种状态：巡逻、追捕、射击<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　巡逻：普通<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　追捕：alertPosition != Vector3.zero<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　射击：EnemySight.isPlayerInSight == true;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">EnemyMoveAI.cs中</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">追捕方法：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private void Chasing() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　nagAgent.speed = 5; // 追捕时速度快 (记住在Patrolling()中navAgent.speed=3;)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　navAgent.destination = enemySight.alertPosition; (EnemySight sight = ...)<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　// 追捕时，目标距离大一些，就可进行射击（）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(navAgent.remainingDistance &lt; 2f) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　到达目标位置后，若看见Player就自动射击（在Animator和Shooting()中控制）<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　如果没看见，alertPosition也没更新，就在原地停留一段时间，解除警报<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- public chaseWaitingTime = 5;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- private chaseTimer = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　chaseTimer += Time.deltaTime;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(chaseTimer &gt; chaseWaitingTime) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 解除警报，回到巡逻位置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　sight.alertPosition = Vector3.zero;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　GameController._instance.lastPlayerPosition = Vector3.zero;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　GameController._instance.isAlarmOn = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　index = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　navAgent.destination = waypoints[index];<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　chaseTimer = 0; //计时器归零<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　}</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t24" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t24" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务35：解决bug：视野检测和自动门的开启和关闭</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- 视野检测：若Player与Enemey之间有障碍物(墙)，Enemy也是可见Player的<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法：若在视野viewFieldAngle内，则在Enemy眼睛处发射一条射线，方向为playerDir</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Raycast的起点为transform.position + Vector3.up * 1.8f; 终点为alertPos<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">RaycastHit hitInfo;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">Physics.Raycast(transform.position+Vector3.up*1.8f, playerDir, out hitInfo);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(hitInfo.collider.tag == Tags.player) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在视野内<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span> (tempAngle &lt;= viewFieldAngle * <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0.5f</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">) {
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 判断是否有障碍物（如墙）挡住视线</span>
<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">    RaycastHit hitInfo;
    Physics.Raycast(transform.position </span>+ Vector3.up * <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">1.8f</span>, playerDir, <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">out</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> hitInfo);
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(hitInfo.collider.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
        playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">true</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 更新警报位置</span>
        alertPosition =<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> other.transform.position;
        GameController._instance.SwitchAlarmOn(other.transform);
    } </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
        playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    }
} </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">else</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> {
    playerInSight </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
}</span></pre></div><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- 门的控制在Player和Enemy同时进出的时候有问题<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法：将player和enemy分别判断并各自count++/--即可</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t25" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t25" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务36&amp;37：机器人的射击动画 &amp;&amp; 伤害计算</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">&nbsp;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">射击动画：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">void&nbsp;Update&nbsp;()&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;if(enemySight.playerInSight)&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;只要能看见Player，就射击<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Shoot();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(enemySight.alertPosition&nbsp;!=&nbsp;Vector3.zero)&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;有动静&nbsp;--&nbsp;进行追捕<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chasing();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Patrolling();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp;&nbsp;&nbsp;&nbsp;}<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Shoot()中不处理动画<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　navAgent.isStopped = true; // 停止导航</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">-- 调用EnemyAnimationController.cs来控制射击动画的播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">在Update()控制行走的代码后，通过playerInSight的赋值来控制动画<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　private EnemySight enemySight = GetComponent...<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　enemyAnim.SetBool("playerInSight", enemySight.playerInSight);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">伤害计算：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在player上添加脚本PlayerHealth.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">public float hp = 100; // 血量</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private void TakeDamege(float damage) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　hp -= damage;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">public bool isPlayerAlive() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　return (hp&gt;0);</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在EnemyMoveAI.cs中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在Update()判断Shoot()或Chasing()时，加上判断如果isPlayerAlive才进行该操作</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">检测enemy状态机中humanoid_weapon_shoot动画的播放：播放一次进行一次伤害计算<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　动画-&gt;Inspector-&gt;Curves-&gt;Shot：看曲线的变化<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在状态机中设置一个参数，用来记录上面Shot曲线的当前值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　添加Parameter float Shot, 这个值会自动被曲线Shot的当前值赋值</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Enemy上添加脚本EnemyShooting() -- 用来处理射击有关的操作</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Update()中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if(anim.GetFloat("Shot") &gt; 0.5f) { // 进行了一次射击<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　Shooting();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">} else {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　hasShot = false; // 没有开枪，则标志位重置<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">伤害机制：距离越近伤害越大，伤害有保底值<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　主角在SphereCollider范围之内会进行射击，则在最外侧伤害最低<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">public float minDamage = 30;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private void Shooting() {&nbsp; // 计算伤害<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　-- private bool hasShot = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(!hasShot) { // 进行伤害<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　-- 从PlayerHealth脚本获得<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// 计算伤害<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　float distance = Vector3.Distance(transform.position, playerHealth.transform.pos);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　float damage = minDamage+ (100-minDamage)*(distance/sphereCollider.radius);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　playerHealth.TakeDamage(damage);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　hasShot = true;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;"><span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">Player死亡动画：</span></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">回顾：在Player的动画状态机中的Parameter bool dead；<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　dead = true时 播放dead动画</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在PlayerHealth.cs中持有animator<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在TakeDamage() 中判断<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(!IsPlayerAlive()) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　anim.SetBool("dead", true);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- Player死亡以后，enemy还是会在盯着，没有回去巡逻<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　解决方法：在EnemySight中触发playerInSight的判断条件里加上<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　&amp;&amp; playerHealth.isPlayerAlive()</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">　　而且Shooting()时把navAgent设为Stopped了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">&nbsp; &nbsp; &nbsp; 　　Enemy从Shooting转为Patrolling时候需要重新设置开始<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　navAgent.isStopped = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　// navAgent.destination =&nbsp; waypoints[index].position; // 不要也行</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- Enemy在PlayerInSight=true的状态下正在射击，但Player跑出了射击范围<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　此时Enemy就会呆在原地不动<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　思路：与上面一个bug相似，Shooting后navAgent被stop了，下一帧转为Chasing()时还是true<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　在Chasing()刚开始的时候，navAgent.isStopped = false;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;"></p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">Bug -- Player死亡以后，死亡动画会不断播放<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　思路：猜想是因为状态机中Any State--dead=true--&gt;Dead<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　AnyState也包括了Dead本身，于是有Dead-&gt;Dead的动画<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　https://blog.csdn.net/ln_polaris/article/details/50724425<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　将transition属性取消勾选<span style="box-sizing: border-box; outline: 0px; font-weight: 700; word-wrap: break-word;">Can Transition To Self</span>即可</p><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t26" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t26" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务38&amp;39：添加其他机器人 和 游戏失败状态 &amp;&amp; 游戏胜利状态</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">将robot apply给prefab</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建空物体Robots，用来存储其他两个敌人(一共三个)</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建对应的waypoints</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">游戏失败状态：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　机制：死亡之后，等待4秒，重新加载Scene</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">IEnumerator ReloadScene() {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　yield return new WaitForSeconds(4f);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　SceneManager.LoadScene(0);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在TakeDamage()中<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　在播放死亡动画之后<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　StartCoroutine(ReloadScene());</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">播放失败音效<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　添加AudioSource组件: endgame<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　defeatAudio.Play();</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">游戏胜利状态：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　机制：胜利之后，启动电梯，并重新加载Scene</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">prop_lift_exit</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">添加BoxCollider作为Trigger</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">编辑之前创建的脚本LiftController.cs</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private float liftUpWaitingTime = 3;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private float liftUpTimer = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private bool isPlayerInside = false;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">分别在OnTriggerEnter/Exit()中控制isPlayerInside，记得判断collider.tag为player</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在Update()中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　if(isPlayerInside) {&nbsp; // player进入电梯<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　liftUpTimer += Time.deltaTime;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　if(liftUpTimer &gt; liftUpWaitingTime) { // 等待时间到，升起电梯<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　-- 电梯只会升起一次<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　// 播放电梯升起音效<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　　　liftUpAudio.Play();<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　}</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">发现，若干秒后电梯向上移动了，但是：</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">1. Player没有随着电梯上升而上升<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　原因：电梯地板没有设置collider<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　　　给电梯添加Mesh Collider, 选择mesh: prop_lift_exit)collision_001<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　原因：player的position.y在Inspector中Freeze，取消勾选</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">2. 电梯上升了一小段便停下了<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　原因未知，但是修改完bug1后这个bug自动消失了</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 60px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">电梯上升后，游戏胜利<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　机制：电梯上升后一段时间，宣布游戏胜利，重新载入Scene</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">private float gameWinTimer = 0;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">private float gameWinWaitingTime = 4;</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 90px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">在电梯上升的代码块中：<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">gameWinTimer += Time.deltaTime;<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">if (gameWinTimer &gt; gameWinTime) {<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">　　SceneManager.LoadScene(0);<br style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">}</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">public</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">class</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> LiftController : MonoBehaviour {
    ...
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> liftUpWaitingTime = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">3</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> liftUpTimer = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> gameWinWaitingTime = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">5</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">float</span> gameWinTimer = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">bool</span> isPlayerInside = <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Update () {
        ...
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 升起电梯</span>
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">(isPlayerInside) {
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> Player在电梯内</span>
            liftUpTimer +=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Time.deltaTime;
            </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(liftUpTimer &gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> liftUpWaitingTime) {
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);">//</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 128, 0);"> 等待时间结束</span>
                transform.Translate(Vector3.up *<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Time.deltaTime);
                gameWinTimer </span>+=<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Time.deltaTime;
                </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(gameWinTimer &gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> gameWinWaitingTime) {
                    SceneManager.LoadScene(</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 128);">0</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">);
    }}}}

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> OnTriggerEnter (Collider other) {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(other.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player){
            isPlayerInside </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">true</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
        }}

    </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">private</span> <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> OnTriggerExit (Collider other) {
        </span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">if</span>(other.tag ==<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Tags.player) {
            isPlayerInside </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">false</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;         
}}}
    </span></pre></div><h2 style="box-sizing: border-box; outline: 0px; margin: 8px 0px 16px; padding: 0px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 24px; color: rgb(79, 79, 79); line-height: 32px; word-wrap: break-word;"><a name="t27" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a><a name="t27" style="box-sizing: border-box; outline: none; margin: 0px; padding: 0px; font-weight: normal; cursor: pointer; color: rgb(78, 161, 219); word-wrap: break-word;"></a>任务40：游戏提示设置 和 总结</h2><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建UI-&gt;Text，字体为Sansation_Light，位置设置为左下角，颜色灰白色</p><p style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px 30px; padding: 0px; font-size: 16px; color: rgb(77, 77, 77); overflow: auto hidden; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 26px !important;">创建脚本MessageShow.cs</p><div class="cnblogs_code" style="box-sizing: border-box; outline: 0px; margin: 0px 0px 0px 60px; padding: 0px; word-wrap: break-word; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px;"><pre style="box-sizing: border-box; outline: 0px; margin-top: 0px; margin-bottom: 24px; padding: 8px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(0, 0, 255);">void</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;"> Start () {
    msg </span>= GetComponent&lt;Text&gt;<span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">();
    msg.text </span>= <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">WASD to Move\n</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span> +
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">Z to Switch Off\n</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span> +
        <span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">LeftShift to Sneak</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word; color: rgb(128, 0, 0);">"</span><span style="box-sizing: border-box; outline: 0px; margin: 0px; padding: 0px; word-wrap: break-word;">;
}</span></pre></div></div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = '02_Socket与WebSocket的区别与联系？.html';
if (e.keyCode === 37) window.location.href = '03_PhotonServer（光子服务器）简单了解及部署.html';
}</script>
    </body>
    </html>
  