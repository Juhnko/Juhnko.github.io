
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Previous: <a href='C#高级进阶教程_12_阶段练习03.html'>C#高级进阶教程_12_阶段练习03</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>C#高级进阶教程_12_异步和多线程（委托的异步使用）</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><b>1、进程-线程-多线程，同步和异步的概念</b></div><div class="cell text-cell"><div>&nbsp; &nbsp; 我们生活中有许许多多关于进程与线程的小例子，比如：1.我们使用打开一个微信软件，这个时候就开启了一个进程，当我们在微信里面进行各种操作（查看朋友圈，扫一扫...），这么多的操作就是线程。</div><div>&nbsp; &nbsp; 所以我们<b>可以说"进程"是包含"线程"的，"线程"是"进程"的一个子集。</b></div></div><div class="cell text-cell"><div><b></b></div></div><div class="cell text-cell"><div>&nbsp; &nbsp; <b>进程（Process）</b> 是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。 在当代面向线程设计的计算机结构中，进程是线程的容器。</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 程序是指令、数据及其组织形式的描述，进程是程序的实体。是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;<b> 线程（thread）</b>是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。</div></div><div class="cell text-cell"><div></div><div></div></div><div class="cell text-cell"><b>简单总结一下：</b><div><b><br></b><div><div>&nbsp; &nbsp; &nbsp; &nbsp; 进程：指在系统中正在运行的一个应用程序；程序一旦运行就是进程；<b>进程——资源分配的最小单位。</b><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; 线程：系统分配处理器时间资源的基本单元，或者说进程之内独立执行的一个单元执行流。<b>线程——程序执行的最小单位。（程序执行流的最小单位）</b></div></div></div><div><b><br></b></div></div><div class="cell text-cell"><b>进程与线程的理解：</b><div><div><div><b></b></div></div></div></div><div class="cell markdown-cell"><p>1.计算机的核心是CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运行。<br>
<img src="resources/522D6F4605009FEC4EACEE26B5CE669A.jpg" alt=""></p>
<p>2.假定工厂的电力有限，一次只能供给一个车间使用。也就是说，一个车间开工的时候，其他车间都必须停工。背后的含义就是，单个CPU一次只能运行一个任务。<br>
<img src="resources/46FA047B83CE7EEE4E54B5E15CC2904E.png" alt=""></p>
<p>3.进程就好比工厂的车间，它代表CPU所能处理的单个任务。任一时刻，CPU总是运行一个进程，其他进程处于非运行状态。<br>
<img src="resources/F8EE5D3398DCEDF90C8DBF25341BCB18.jpg" alt=""></p>
<p>4.一个车间里，可以有很多工人。他们协同完成一个任务。<br>
<img src="resources/DC2661C05B863B8D6BBAF9C03BC79A69.jpg" alt=""></p>
<p>5.线程就好比车间里的工人。一个进程可以包括多个线程。<br>
<img src="resources/1ABC8CBC065F90C2715223B67B910B6F.jpg" alt=""></p>
<p>6.车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。<br>
<img src="resources/EF70CAD67455E1704176CF8BD36AE567.png" alt=""></p>
<p>7.可是，每间房间的大小不同，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。<br>
<img src="resources/E9C7DD1D7B36F41D9149C7D594D66B50.jpg" alt=""></p>
<p>8.一个防止他人进入的简单方法，就是门口加一把锁。先到的人锁上门，后到的人看到上锁，就在门口排队，等锁打开再进去。这就叫<a href="http://zh.wikipedia.org/wiki/%E4%BA%92%E6%96%A5%E9%94%81">"互斥锁"</a>（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。<br>
<img src="resources/D200DAE5A2B043577EBC92E7AB286273.jpg" alt=""></p>
<p>9.还有些房间，可以同时容纳n个人，比如厨房。也就是说，如果人数大于n，多出来的人只能在外面等着。这好比某些内存区域，只能供给固定数目的线程使用。<br>
<img src="resources/D8D5AC7E30DF2A052716E4DB42A4129A.jpg" alt=""></p>
<p>10.这时的解决方法，就是在门口挂n把钥匙。进去的人就取一把钥匙，出来时再把钥匙挂回原处。后到的人发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做<a href="http://en.wikipedia.org/wiki/Semaphore_(programming)">"信号量"</a>（Semaphore），用来保证多个线程不会互相冲突。</p>
<p>不难看出，mutex是semaphore的一种特殊情况（n=1时）。也就是说，完全可以用后者替代前者。但是，因为mutex较为简单，且效率高，所以在必须保证资源独占的情况下，还是采用这种设计。</p>
<p><img src="resources/2A80F8668CE0C92E2B3D9F934E22D17B.jpg" alt=""></p>
<ol start="11">
<li></li>
</ol>
<p><img src="resources/5595EB7237CF6CB868F9306E6786B6F3.png" alt=""><br>
操作系统的设计，因此可以归结为三点：<br>
（1）以多进程形式，允许多个任务同时运行；<br>
（2）以多线程形式，允许单个任务分成不同的部分运行；<br>
（3）提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。</p>
</div><div class="cell text-cell"><h2>计算机的概念</h2></div><div class="cell text-cell"><h3>01、进程与线程&nbsp;</h3></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">进程和线程是计算机的概念。</font></b><h3></h3><h2></h2>
</div><div class="cell text-cell"><font><b>进程：</b>一个程序运行时，占用的所有计算资源的总和。</font><div><font><b>线程：</b>程序执行流的最小单位；任何操作都是由线程完成的；</font></div><div><font>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 线程依托于进程存在的，一个进程可以包含多个线程；</font></div><div><font>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 线程也可以有自己的计算资源。</font></div></div><div class="cell text-cell"><h3><b>02、多线程</b></h3></div><div class="cell text-cell">1. 多个执行流同时进行。<br><b></b><div><font color="#323232"><span style="background-color: rgb(254, 250, 0);"><b></b></span></font></div><div>&nbsp; &nbsp; CPU太快了，<b><font color="#323232" style="background-color: rgb(254, 250, 0);"><font>分时间片</font>。</font>（上下文切换）</b></div><div>&nbsp; &nbsp; 微观角度，一个核同一时刻只能执行一个线程；宏观角度，多线程并发执行。</div><div><br></div><div>2.多CPU多核 &nbsp;可以独立工作，并发进行。</div><div>&nbsp; &nbsp; 6核12线程（6个物理核，12个虚拟核。这里的“线程”代表的是虚拟核）</div><div><br></div><div><b>3.<font color="#323232" style="background-color: rgb(254, 250, 0);">Tread类是C#语言对线程对象的封装。</font></b></div></div><div class="cell text-cell">&nbsp; &nbsp;计算机方面的多线程和开发Tread，Task、TreadPool、Parallel中的多线程不完全一样。<div><b></b></div></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">并发执行</font></b>机制原理：<div><font color="#323232"><span style="background-color: rgb(254, 250, 0);"><b></b></span></font></div><div>&nbsp; &nbsp; &nbsp; 简单地说就是把一个处理器划分为若干个短的时间片，每个时间片依次轮流地执行处理各个应用程序，由于一个时间片很短，相对于一个应用程序来说，就好像是处理器在为自己单独服务一样，从而达到多个应用程序在同时进行的效果。</div></div><div class="cell text-cell"><h3>03、同步/异步</h3></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">同步/异步是对方法执行的描述。</font></b></div><div class="cell text-cell"><b>同步</b>：完成计算后，再进入下一行。<b><font color="#323232" style="background-color: rgb(254, 250, 0);">按顺序执行。</font></b><div><b>异步</b>：不会等待方法的完成，会直接进入下一行。<b><font color="#323232" style="background-color: rgb(254, 250, 0);">无需等待执行。非阻塞。</font></b></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">action</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Invoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">action</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">BeginInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_language">null</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_language">null</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell text-cell"><h3>04、异步、多线程</h3><div><b><font color="#323232" style="background-color: rgb(254, 250, 0);"></font></b></div></div><div class="cell text-cell"><div><b>认识</b>：C#异步、多线程。多线程就是多个Tread并发；C#语言里面的东西。</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;线程是源于操作系统的。</div><h3></h3><div></div><div><b>理解</b>：同步方法卡界面（主UI线程，忙于计算）</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;异步多线程方法不卡界面，主线程完事儿了，计算任务交给子线程在做。</div></div><div class="cell text-cell"><div></div></div><div class="cell text-cell"><b>异步多线程作用</b><div>1、可以提升用户体验。(Winform，还可以使用主UI线程)<div></div></div><div>2、一个业务操作后发送邮件。（web开发，异步发送邮件。无需等待）<b><font color="#323232" style="background-color: rgb(254, 250, 0);">异步+回调？异步多线程和Ajax区别？</font></b></div><div><font>3、速度快。用资源换时间（可能出现资源不够的情况）</font></div><div><font>4、多线程有管理成本。</font></div><div><font>5、<b><font color="#323232" style="background-color: rgb(254, 250, 0);">多个独立任务</font></b>可以同时进行的情况下，才有使用价值！</font></div><div><font>6、启动无序、执行时间不确定。结束也无序。</font></div><div><font>&nbsp;</font></div><div>注意：尽量避免通过等几毫秒的形式来控制启动/执行时间/结束。//Tread.Sleep(5); 顺序控制不好控制！</div></div><div class="cell text-cell"></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">回调 / 状态检测 / 状态等待 / 信号量？？</font></b></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);"></font></b><div></div><div></div></div><div class="cell text-cell"><h3><b><font>Action和Func 委托的异步调用</font></b></h3><div><b><font color="#323232" style="background-color: rgb(254, 250, 0);">AsyncCallback 异步回调函数</font></b></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_keyword">void</span> <span class="ace_identifier">btnAsyncAdvanced_Click</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">object</span> <span class="ace_identifier">sender</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">EventArgs</span> <span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnAsyncAdvanced_Click Start {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">Action</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">string</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">action</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">IAsyncResult</span> <span class="ace_identifier">asyncResult0</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">null</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">AsyncCallback</span> <span class="ace_identifier">callback</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">ia</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">传</span><span class="ace_cjk" style="width:NaNpx">入</span>ia<span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">执</span><span class="ace_cjk" style="width:NaNpx">行</span><span class="ace_cjk" style="width:NaNpx">下</span><span class="ace_cjk" style="width:NaNpx">面</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">方</span><span class="ace_cjk" style="width:NaNpx">法</span><span class="ace_cjk" style="width:NaNpx">体</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">object</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ReferenceEquals</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">ia</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//Reference<span class="ace_cjk" style="width:NaNpx">引</span><span class="ace_cjk" style="width:NaNpx">用</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ia</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncState</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">经</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span>{Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)}<span class="ace_cjk" style="width:NaNpx">。</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">asyncResult0</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">action</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">BeginInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnAsyncAdvanced_Click</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">callback</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">hao</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">函</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">此</span><span class="ace_cjk" style="width:NaNpx">方</span><span class="ace_cjk" style="width:NaNpx">法</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">之</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">才</span><span class="ace_cjk" style="width:NaNpx">会</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">函</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">经</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span>{Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)}<span class="ace_cjk" style="width:NaNpx">。</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_keyword">void</span> <span class="ace_identifier">btnAsyncAdvanced_Click</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">object</span> <span class="ace_identifier">sender</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">EventArgs</span> <span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnAsyncAdvanced_Click Start {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">0000000</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Action</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">string</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">action</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">IAsyncResult</span> <span class="ace_identifier">asyncResult0</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language">null</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">AsyncCallback</span> <span class="ace_identifier">callback</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">ia</span> <span class="ace_keyword ace_operator">=&gt;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">函</span><span class="ace_cjk" style="width:NaNpx">数</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">object</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ReferenceEquals</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">ia</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ia</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncState</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">经</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span>{Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)}<span class="ace_cjk" style="width:NaNpx">。</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">asyncResult0</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">action</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">BeginInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnAsyncAdvanced_Click</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">callback</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">hao</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span>Action<span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">异</span><span class="ace_cjk" style="width:NaNpx">步</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">用</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">while</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">!</span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">IsCompleted</span><span class="ace_paren ace_rparen">)</span><span class="ace_comment">//1 <span class="ace_cjk" style="width:NaNpx">卡</span><span class="ace_cjk" style="width:NaNpx">界</span><span class="ace_cjk" style="width:NaNpx">面</span><span class="ace_cjk" style="width:NaNpx">：</span><span class="ace_cjk" style="width:NaNpx">主</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">忙</span><span class="ace_cjk" style="width:NaNpx">于</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>   <span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">边</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span><span class="ace_cjk" style="width:NaNpx">边</span><span class="ace_cjk" style="width:NaNpx">做</span><span class="ace_cjk" style="width:NaNpx">其</span><span class="ace_cjk" style="width:NaNpx">他</span><span class="ace_cjk" style="width:NaNpx">操</span><span class="ace_cjk" style="width:NaNpx">作</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">能</span><span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">多</span>200ms<span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">延</span><span class="ace_cjk" style="width:NaNpx">迟</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">文</span><span class="ace_cjk" style="width:NaNpx">件</span><span class="ace_cjk" style="width:NaNpx">上</span><span class="ace_cjk" style="width:NaNpx">传</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span>{i++ * 10}%..</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//File.ReadSize</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">else</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">文</span><span class="ace_cjk" style="width:NaNpx">件</span><span class="ace_cjk" style="width:NaNpx">上</span><span class="ace_cjk" style="width:NaNpx">传</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span>99.9%..</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">200</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span>200<span class="ace_cjk" style="width:NaNpx">毫</span><span class="ace_cjk" style="width:NaNpx">秒</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">上</span><span class="ace_cjk" style="width:NaNpx">传</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">功</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span>..</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p><img src="resources/8D23A3B21044A753826A7426C65D5ECC.png" alt="IMAGE" width="1440" height="365"></p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncWaitHandle</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span><span class="ace_cjk" style="width:NaNpx">任</span><span class="ace_cjk" style="width:NaNpx">务</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">及</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncWaitHandle</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">-1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span><span class="ace_cjk" style="width:NaNpx">任</span><span class="ace_cjk" style="width:NaNpx">务</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">asyncResult0</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncWaitHandle</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">限</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span><span class="ace_cjk" style="width:NaNpx">；</span><span class="ace_cjk" style="width:NaNpx">但</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">多</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span>1000ms</span>
</div></div></div></div><div class="cell text-cell"><div><br></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">action</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">EndInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">asyncResult0</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Func</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">func</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">return</span> <span class="ace_identifier">DateTime</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Now</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Day</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">带</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">值</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span>Func</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">func.Invoke()={func.Invoke()}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">拿</span><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">结</span><span class="ace_cjk" style="width:NaNpx">果</span>unc.Invoke();</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">IAsyncResult</span> <span class="ace_identifier">asyncResult</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">func</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">BeginInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_comment">//r<span class="ace_cjk" style="width:NaNpx">为</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">函</span><span class="ace_cjk" style="width:NaNpx">数</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">func</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">EndInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncState</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">打</span><span class="ace_cjk" style="width:NaNpx">印</span>LJK</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">func.EndInvoke(asyncResult)={func.EndInvoke(asyncResult)}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//func.EndInvoke(asyncResult)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">全</span><span class="ace_cjk" style="width:NaNpx">部</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">真</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">都</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">然</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">给</span><span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">户</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span>{Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnAsyncAdvanced_Click End   {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell"><div><br></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_keyword">void</span> <span class="ace_identifier">btnAsyncAdvanced_Click</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">object</span> <span class="ace_identifier">sender</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">EventArgs</span> <span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnAsyncAdvanced_Click Start {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">0000000</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Action</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">string</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">action</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">200</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Do Something Else......</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Do Something Else......</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Do Something Else......</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Func</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">func</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_keyword">return</span> <span class="ace_identifier">DateTime</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Now</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Year</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">func.Invoke()={func.Invoke()}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">IAsyncResult</span> <span class="ace_identifier">asyncResult</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">func</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">BeginInvoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_comment">//func.EndInvoke(r);</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">________func.EndInvoke(asyncResult)={func.EndInvoke(r)}</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//func.EndInvoke(r)<span class="ace_cjk" style="width:NaNpx">；</span><span class="ace_cjk" style="width:NaNpx">结</span><span class="ace_cjk" style="width:NaNpx">果</span><span class="ace_cjk" style="width:NaNpx">为</span>2021<span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">________</span><span class="ace_string ace_end">"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">r</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">AsyncState</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">状</span><span class="ace_cjk" style="width:NaNpx">态</span></span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">________</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">ljk</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>   <span class="ace_comment">//Console.WriteLine($"func.EndInvoke(asyncResult)={func.EndInvoke(asyncResult)}");//<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">拿</span><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">结</span><span class="ace_cjk" style="width:NaNpx">果</span><span class="ace_cjk" style="width:NaNpx">值</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">全</span><span class="ace_cjk" style="width:NaNpx">部</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">真</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">都</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">然</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">给</span><span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">户</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span>{Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">000000</span><span class="ace_string ace_start">"</span><span class="ace_string">)}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnAsyncAdvanced_Click End   {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">000000</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p><img src="resources/7A1C7A4EA248C639D2051E728AF58B1E.png" alt="IMAGE" width="1098" height="343"></p>
</div><div class="cell text-cell"><p><b><font color="#323232" style="background-color: rgb(254, 250, 0);">附：如何将类封装起来，提供成一个dll？</font></b></p></div><div class="cell text-cell"><p><b><font color="#323232" style="background-color: rgb(254, 250, 0);"></font></b></p>
<div><br></div><div><br></div><div><br></div><div><br></div></div><div class="cell text-cell"><h2>多线程</h2></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">Tread、TreadPool、Task、Parallel</font></b><h2></h2>
</div><div class="cell text-cell"><h3><b>1、Tread 线程</b></h3></div><div class="cell text-cell"><b><font>.Net 1.0 时代</font></b></div><div class="cell text-cell"><b>01、线程的开启、挂起、唤醒、销毁、取消销毁</b><br><b></b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Action</span> <span class="ace_identifier">action</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreads_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">无</span><span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">无</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">值</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadStart</span> <span class="ace_identifier">threadStart</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreads_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//ThreadStart<span class="ace_cjk" style="width:NaNpx">类</span><span class="ace_cjk" style="width:NaNpx">似</span><span class="ace_cjk" style="width:NaNpx">于</span>Action<span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">但</span><span class="ace_cjk" style="width:NaNpx">又</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">同</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//Thread thread = new Thread(action);//<span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">个</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">错</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">虽</span><span class="ace_cjk" style="width:NaNpx">然</span><span class="ace_cjk" style="width:NaNpx">类</span><span class="ace_cjk" style="width:NaNpx">型</span><span class="ace_cjk" style="width:NaNpx">样</span><span class="ace_cjk" style="width:NaNpx">式</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">样</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">但</span><span class="ace_cjk" style="width:NaNpx">类</span><span class="ace_cjk" style="width:NaNpx">型</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">同</span><span class="ace_cjk" style="width:NaNpx">的</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Thread</span> <span class="ace_identifier">thread</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">new</span> <span class="ace_identifier">Thread</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">threadStart</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Start</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Suspend</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">挂</span><span class="ace_cjk" style="width:NaNpx">起</span><span class="ace_cjk" style="width:NaNpx">（</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">被</span><span class="ace_cjk" style="width:NaNpx">放</span><span class="ace_cjk" style="width:NaNpx">弃</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">容</span><span class="ace_cjk" style="width:NaNpx">易</span><span class="ace_cjk" style="width:NaNpx">导</span><span class="ace_cjk" style="width:NaNpx">致</span><span class="ace_cjk" style="width:NaNpx">死</span><span class="ace_cjk" style="width:NaNpx">锁</span><span class="ace_cjk" style="width:NaNpx">）</span><span class="ace_cjk" style="width:NaNpx">资</span><span class="ace_cjk" style="width:NaNpx">源</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">占</span><span class="ace_cjk" style="width:NaNpx">用</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Resume</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">唤</span><span class="ace_cjk" style="width:NaNpx">醒</span><span class="ace_cjk" style="width:NaNpx">（</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">被</span><span class="ace_cjk" style="width:NaNpx">放</span><span class="ace_cjk" style="width:NaNpx">弃</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">容</span><span class="ace_cjk" style="width:NaNpx">易</span><span class="ace_cjk" style="width:NaNpx">导</span><span class="ace_cjk" style="width:NaNpx">致</span><span class="ace_cjk" style="width:NaNpx">死</span><span class="ace_cjk" style="width:NaNpx">锁</span><span class="ace_cjk" style="width:NaNpx">）</span></span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">try</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Abort</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">销</span><span class="ace_cjk" style="width:NaNpx">毁</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">方</span><span class="ace_cjk" style="width:NaNpx">式</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">抛</span><span class="ace_cjk" style="width:NaNpx">异</span><span class="ace_cjk" style="width:NaNpx">常</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">也</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">建</span><span class="ace_cjk" style="width:NaNpx">议</span><span class="ace_cjk" style="width:NaNpx">（</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">定</span><span class="ace_cjk" style="width:NaNpx">及</span><span class="ace_cjk" style="width:NaNpx">时</span>/<span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">些</span><span class="ace_cjk" style="width:NaNpx">动</span><span class="ace_cjk" style="width:NaNpx">作</span><span class="ace_cjk" style="width:NaNpx">发</span><span class="ace_cjk" style="width:NaNpx">出</span><span class="ace_cjk" style="width:NaNpx">收</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">来</span><span class="ace_cjk" style="width:NaNpx">）</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">catch</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Exception</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ResetAbort</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">取</span><span class="ace_cjk" style="width:NaNpx">消</span>Abort<span class="ace_cjk" style="width:NaNpx">异</span><span class="ace_cjk" style="width:NaNpx">常</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell text-cell"><b>02、线程等待</b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Join</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">500</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">多</span><span class="ace_cjk" style="width:NaNpx">等</span>500<span class="ace_cjk" style="width:NaNpx">，</span>Join<span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">重</span><span class="ace_cjk" style="width:NaNpx">载</span><span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span>500ms</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Join</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">当</span><span class="ace_cjk" style="width:NaNpx">前</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span>thread<span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span></span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">while</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ThreadState</span> <span class="ace_keyword ace_operator">!=</span> <span class="ace_identifier">ThreadState</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Stopped</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">当</span><span class="ace_cjk" style="width:NaNpx">前</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span> <span class="ace_cjk" style="width:NaNpx">休</span><span class="ace_cjk" style="width:NaNpx">息</span>100ms</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell text-cell"><b>03、<font color="#323232" style="background-color: rgb(254, 250, 0);">前台线程和后台线程</font></b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">IsBackground</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">默</span><span class="ace_cjk" style="width:NaNpx">认</span><span class="ace_cjk" style="width:NaNpx">是</span>flase<span class="ace_cjk" style="width:NaNpx">。</span> <span class="ace_cjk" style="width:NaNpx">前</span><span class="ace_cjk" style="width:NaNpx">台</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">启</span><span class="ace_cjk" style="width:NaNpx">动</span><span class="ace_cjk" style="width:NaNpx">之</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">定</span><span class="ace_cjk" style="width:NaNpx">要</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">任</span><span class="ace_cjk" style="width:NaNpx">务</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">阻</span><span class="ace_cjk" style="width:NaNpx">止</span><span class="ace_cjk" style="width:NaNpx">进</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">退</span><span class="ace_cjk" style="width:NaNpx">出</span><span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">IsBackground</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_language ace_boolean">true</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">指</span><span class="ace_cjk" style="width:NaNpx">定</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">台</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">：</span><span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">着</span><span class="ace_cjk" style="width:NaNpx">进</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">退</span></span>
</div></div></div></div><div class="cell text-cell"><b>04、线程的优先级</b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span> <span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Priority</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">ThreadPriority</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Highest</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">优</span><span class="ace_cjk" style="width:NaNpx">先</span><span class="ace_cjk" style="width:NaNpx">级</span> CPU<span class="ace_cjk" style="width:NaNpx">优</span><span class="ace_cjk" style="width:NaNpx">先</span><span class="ace_cjk" style="width:NaNpx">执</span><span class="ace_cjk" style="width:NaNpx">行</span>Highest</span>
</div></div></div></div><div class="cell text-cell"><div><br></div></div><div class="cell text-cell"><h3>2、ThreadPool 线程池</h3></div><div class="cell text-cell"><b>.Net 2.0 时代</b><div>线程池——享元模式——数据库连接池</div></div><div class="cell text-cell">01、Thread提供了太多的API，大部分意义不大。容易误伤… …<div>02、会无限使用线程，加以限制。</div><div><font color="#323232" style="font-weight: bold; background-color: rgb(254, 250, 0);">03、重用线程，避免重复的创建和销毁！准备容器Pool，减少创建和销毁的开销。</font></div></div><div class="cell text-cell"><b>01、线程池启动多线程</b><div><font color="#323232" style="font-weight: bold; background-color: rgb(254, 250, 0);"></font></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************btnThreadPool_Click Start {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">1000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">前</span><span class="ace_cjk" style="width:NaNpx">面</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">都</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell text-cell"><b>02、线程池的最大线程数、最小线程数</b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">SetMaxThreads</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">16</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">16</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">SetMinThreads</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">8</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">GetMaxThreads</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">out</span> <span class="ace_keyword">int</span> <span class="ace_identifier">workerThreads</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword">out</span> <span class="ace_keyword">int</span> <span class="ace_identifier">completionPortThreads</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">GetMaxThreads workerThreads={workerThreads} completionPortThreads={completionPortThreads}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">GetMinThreads</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">out</span> <span class="ace_keyword">int</span> <span class="ace_identifier">workerThreads</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword">out</span> <span class="ace_keyword">int</span> <span class="ace_identifier">completionPortThreads</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">GetMinThreads workerThreads={workerThreads} completionPortThreads={completionPortThreads}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell text-cell"><b>03、ThreadPool 线程等待</b></div><div class="cell text-cell"><b><font color="#323232" style="background-color: rgb(254, 250, 0);">ManualResetEvent 手动重置事件。其他Api基本取消了。</font></b></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">类</span>  <span class="ace_cjk" style="width:NaNpx">包</span><span class="ace_cjk" style="width:NaNpx">含</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">个</span>bool<span class="ace_cjk" style="width:NaNpx">属</span><span class="ace_cjk" style="width:NaNpx">性</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//false--WaitOne<span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span>--Set--true--WaitOne<span class="ace_cjk" style="width:NaNpx">直</span><span class="ace_cjk" style="width:NaNpx">接</span><span class="ace_cjk" style="width:NaNpx">过</span><span class="ace_cjk" style="width:NaNpx">去</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//true--WaitOne<span class="ace_cjk" style="width:NaNpx">直</span><span class="ace_cjk" style="width:NaNpx">接</span><span class="ace_cjk" style="width:NaNpx">过</span><span class="ace_cjk" style="width:NaNpx">去</span>--ReSet--false--WaitOne<span class="ace_cjk" style="width:NaNpx">等</span><span class="ace_cjk" style="width:NaNpx">待</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ManualResetEvent</span> <span class="ace_identifier">manualResetEvent</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">new</span> <span class="ace_identifier">ManualResetEvent</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_language ace_boolean">false</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">manualResetEvent</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">//manualResetEvent.Reset();</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">manualResetEvent</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> 
</div></div></div></div><div class="cell text-cell">但是一般来说，不要阻塞线程池的线程。</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">20</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_keyword">int</span> <span class="ace_identifier">k</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">i</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span>   <span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">开</span><span class="ace_cjk" style="width:NaNpx">启</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">池</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">k</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">用</span>i<span class="ace_cjk" style="width:NaNpx">会</span><span class="ace_cjk" style="width:NaNpx">报</span><span class="ace_cjk" style="width:NaNpx">错</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">k</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">18</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_comment">//manualResetEvent.Reset();//<span class="ace_cjk" style="width:NaNpx">设</span><span class="ace_cjk" style="width:NaNpx">置</span><span class="ace_cjk" style="width:NaNpx">为</span>false</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">manualResetEvent</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">设</span><span class="ace_cjk" style="width:NaNpx">置</span><span class="ace_cjk" style="width:NaNpx">为</span>false</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">else</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">manualResetEvent</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">manualResetEvent</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WaitOne</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">没</span><span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">死</span><span class="ace_cjk" style="width:NaNpx">锁</span><span class="ace_cjk" style="width:NaNpx">、</span><span class="ace_cjk" style="width:NaNpx">、</span><span class="ace_cjk" style="width:NaNpx">、</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell text-cell"><div><b>04、线程池的重用</b></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">1000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">前</span><span class="ace_cjk" style="width:NaNpx">面</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span><span class="ace_cjk" style="width:NaNpx">都</span><span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span><span class="ace_cjk" style="width:NaNpx">。</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">ThreadPool</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">QueueUserWorkItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">btnThreadPool_Click</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_keyword">void</span> <span class="ace_identifier">DoSomethingLong</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">string</span> <span class="ace_identifier">name</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************DoSomethingLong {name} Start {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">long</span> <span class="ace_identifier">lResult</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">for</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">1000000000</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">lResult</span> <span class="ace_keyword ace_operator">+=</span> <span class="ace_identifier">i</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">//Thread.Sleep(2000);</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string">****************DoSomethingLong {name}   End {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">00</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {DateTime.Now.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_identifier">yyyy</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">MM</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">dd</span> <span class="ace_identifier">HH</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">mm</span><span class="ace_punctuation ace_operator">:</span><span class="ace_identifier">ss</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fff</span><span class="ace_string ace_start">"</span><span class="ace_string">)} {lResult}***************</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p><img src="resources/CB9A1F9BF5EC5814354988EB340CAFDE.png" alt="IMAGE" width="1376" height="411"></p>
</div><div class="cell text-cell"><b>05、线程的回调</b><div><b><br></b></div><div><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;基于Thread线程的回调</b></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">启</span><span class="ace_cjk" style="width:NaNpx">动</span><span class="ace_cjk" style="width:NaNpx">子</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">计</span><span class="ace_cjk" style="width:NaNpx">算</span>--<span class="ace_cjk" style="width:NaNpx">完</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">该</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">去</span><span class="ace_cjk" style="width:NaNpx">执</span><span class="ace_cjk" style="width:NaNpx">行</span><span class="ace_cjk" style="width:NaNpx">后</span><span class="ace_cjk" style="width:NaNpx">续</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_keyword">void</span> <span class="ace_identifier">ThreadWithCallback</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Action</span> <span class="ace_identifier">act</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">Action</span> <span class="ace_identifier">callback</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Thread</span> <span class="ace_identifier">thread</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">new</span> <span class="ace_identifier">Thread</span><span class="ace_paren ace_lparen">((</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">act</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Invoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">callback</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Invoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">和</span><span class="ace_cjk" style="width:NaNpx">委</span><span class="ace_cjk" style="width:NaNpx">托</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">异</span><span class="ace_cjk" style="width:NaNpx">步</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">样</span><span class="ace_cjk" style="width:NaNpx">的</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Start</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ThreadWithCallback</span><span class="ace_paren ace_lparen">((</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">是</span>action  {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">000</span><span class="ace_string ace_start">"</span><span class="ace_string">)}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">,</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span> <span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">$"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">是</span>callback  {Thread.CurrentThread.ManagedThreadId.ToString(</span><span class="ace_string ace_end">"</span><span class="ace_constant ace_numeric">000</span><span class="ace_string ace_start">"</span><span class="ace_string">)}</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">主</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">！</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell markdown-cell"><p><img src="resources/FA8E8003AE7AE063DA1B8556FF31BDDA.png" alt=""></p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//<span class="ace_cjk" style="width:NaNpx">带</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">异</span><span class="ace_cjk" style="width:NaNpx">步</span><span class="ace_cjk" style="width:NaNpx">调</span><span class="ace_cjk" style="width:NaNpx">用</span>,<span class="ace_cjk" style="width:NaNpx">需</span><span class="ace_cjk" style="width:NaNpx">要</span><span class="ace_cjk" style="width:NaNpx">获</span><span class="ace_cjk" style="width:NaNpx">取</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">值</span><span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">private</span> <span class="ace_identifier">Func</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">T</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">ThreadWithReturn</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">T</span><span class="ace_keyword ace_operator">&gt;</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Func</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">T</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">func</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">T</span> <span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">default</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">T</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// default<span class="ace_cjk" style="width:NaNpx">关</span><span class="ace_cjk" style="width:NaNpx">键</span><span class="ace_cjk" style="width:NaNpx">字</span><span class="ace_cjk" style="width:NaNpx">？</span>?</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">Thread</span> <span class="ace_identifier">thread</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">new</span> <span class="ace_identifier">Thread</span><span class="ace_paren ace_lparen">((</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">t</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">func</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Invoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Start</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_keyword">return</span> <span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Join</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">return</span> <span class="ace_identifier">t</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_paren ace_rparen">}</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Func</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">func</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">this</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ThreadWithReturn</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_keyword">int</span><span class="ace_keyword ace_operator">&gt;</span><span class="ace_paren ace_lparen">((</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">=&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">Thread</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2000</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">return</span> <span class="ace_identifier">DateTime</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Now</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Year</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">})</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string"><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">里</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">主</span><span class="ace_cjk" style="width:NaNpx">线</span><span class="ace_cjk" style="width:NaNpx">程</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">！</span></span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">int</span> <span class="ace_identifier">iResult</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">func</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">Invoke</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Console</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">WriteLine</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">iResult</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell markdown-cell"><p><img src="resources/EA398D4B7796B6DB35E9050768E64CC7.png" alt="IMAGE" width="975" height="106"></p>
</div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 37) window.location.href = 'C#高级进阶教程_12_阶段练习03.html';
}</script>
    </body>
    </html>
  